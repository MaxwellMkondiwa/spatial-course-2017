library(ggplot2)
library(RColorBrewer)
library(akima)
library(fields)
library(ggmap)
library(maps)
library(spBayes)
library(MBA)
library(classInt)
library(plotrix)
data1=read.csv("../data/dataset1.csv")
colors=colorRampPalette(c("midnightblue", "cyan","yellow","red"))(5)
dev.new()
dev.new()
plot(data1$sx,data1$sy,xlab="",ylab="",main="Data locations")
colors=colorRampPalette(c("midnightblue", "cyan","yellow","red"))(5)
quants=classIntervals(data1$y,n=5,style="quantile")
sc=scale_colour_gradientn(colours = colors,values=rescale(quants$brks,c(0,1)),name="y")
p0 = ggplot(data=data1,aes(x=sx,y=sy))+sc+labs(x = "",y = "")
p1=p0+geom_point(data=data1,aes(x=sx,y=sy,color=y))+guides(fill=guide_colorbar(title="y"))
plot(p1)
dev.new()
plot(p1)
frange=function(x,n) seq(min(x),max(x),length=n)
intobj1=interp(data1$sx,data1$sy,data1$y,
xo=frange(data1$sx,200),yo=frange(data1$sy,200))
interpdata1=cbind(expand.grid(intobj1$x,intobj1$y),as.vector(intobj1$z))
colnames(interpdata1)=c("sx","sy","y")
p1interp=p0+geom_raster(data=interpdata1,aes(x=sx,y=sy,fill=y))+
scale_fill_gradientn(colours=colors,values=rescale(quants$brks,c(0,1)),name="y")
plot(p1interp)
rm(list=ls())
data(WEF.dat)
head(WEF.dat)
WEF.dat <- WEF.dat[!apply(WEF.dat[,c("East_m","North_m","DBH_cm","Tree_height_m","ELEV_m")], 1, function(x)any(is.na(x))),]
DBH <- WEF.dat$DBH_cm
coords <- as.matrix(WEF.dat[,c("East_m","North_m")])
plot(coords, pch=1, cex=sqrt(DBH)/10, col="darkgreen", xlab="Easting (m)", ylab="Northing (m)")
leg.vals <- round(quantile(DBH),0)
legend("topleft", pch=1, legend=leg.vals, col="darkgreen", pt.cex=sqrt(leg.vals)/10, bty="n", title="DBH (cm)")
col.br <- colorRampPalette(c("midnightblue", "cyan", "yellow", "red"))
col.pal <- col.br(5)
quant <- classIntervals(DBH, n=5, style="quantile")
plot(quant, pal=col.pal, xlab="DBH", main="Quantile")
quant.col <- findColours(quant, col.pal)
plot(coords, col=quant.col, pch=19, cex=0.5, main="Quantile", xlab="Easting (m)", ylab="Northing (m)")
legend("topleft", fill=attr(quant.col, "palette"),
legend=names(attr(quant.col, "table")), bty="n")
fixed <- classIntervals(DBH, n=4, style="fixed", fixedBreaks=c(0,12.7,30.48,60,max(DBH)+1))
fixed.col <- findColours(fixed, col.pal)
plot(coords, col=fixed.col, pch=19, cex=0.5, main="Forestry tree size classes", xlab="Easting (m)", ylab="Northing (m)")
legend("topleft", fill=attr(fixed.col, "palette"), legend=c("sapling","poletimber","sawtimber","large sawtimber"), bty="n")
x.res <- 100; y.res <- 100
surf <- mba.surf(cbind(coords, DBH), no.X=x.res, no.Y=y.res, h=5, m=2, extend=FALSE)$xyz.est
image.plot(surf, xaxs = "r", yaxs = "r", xlab="Easting (m)", ylab="Northing (m)", col=col.br(25))
library(geoR)
data1=read.csv("../data/dataset1.csv")
data2=read.csv("../data/dataset2.csv")
data3=read.csv("../data/dataset3.csv")
col.br <- colorRampPalette(c("midnightblue", "cyan", "yellow", "red"))
col.pal <- col.br(5)
myplot=function(tab,colname){
surf <- mba.surf(tab[,c("sx","sy",colname)], no.X=100, no.Y=100, h=5, m=2, extend=FALSE)$xyz.est
dev.new()
image.plot(surf, xaxs = "r", yaxs = "r", xlab="Easting (m)", ylab="Northing (m)", col=col.br(25))
}
dev.new()
myplot(data1,"y")
myplot(data2,"y")
myplot(data3,"y")
myplot(data3,"x")
head(data1)
lmobj1=lm(y~x,data=data1)
lmobj2=lm(y~x,data=data2)
lmobj3=lm(y~x,data=data3)
summary(lmobj1)
summary(lmobj2)
summary(lmobj3)
data1$res=lmobj1$residuals
data2$res=lmobj2$residuals
data3$res=lmobj3$residuals
myplot(data1,"res")
myplot(data2,"res")
myplot(data3,"res")
max.dist <- 0.75*max(iDist(data1[,1:2]))
bins <- 20
n=nrow(data1)
ydiff=diff=rep(0,n^2)
for(i in 2:n) for(j in 1:(i-1)) {
ydiff[(i-1)*n+j]=(data1$y[i]-data1$y[j])^2
diff[(i-1)*n+j]=sqrt(sum(data1[i,1:2]-data1[j,1:2])^2)
}
dev.new()
plot(diff,ydiff,xlab="",ylab="")
vario1raw <- variog(coords=data1[,1:2], data=data1$y, uvec=(seq(0, max.dist, length=bins)))
plot(vario1raw,pch=16)
vario1 <- variog(coords=data1[,1:2], data=data1$res, uvec=(seq(0, max.dist, length=bins)))
plot(vario1,pch=16)
vario2 <- variog(coords=data1[,1:2], data=data2$res, uvec=(seq(0, max.dist, length=bins)))
plot(vario2,pch=16)
vario3 <- variog(coords=data1[,1:2], data=data3$res, uvec=(seq(0, max.dist, length=bins)))
plot(vario3,pch=16)
data(WEF.dat)
WEF.dat <- WEF.dat[!apply(WEF.dat[,c("East_m","North_m","DBH_cm","Tree_height_m","ELEV_m")], 1, function(x)any(is.na(x))),]
DBH <- WEF.dat$DBH_cm
coords <- as.matrix(WEF.dat[,c("East_m","North_m")])
col.br <- colorRampPalette(c("midnightblue", "cyan", "yellow", "red"))
col.pal <- col.br(5)
surf <- mba.surf(cbind(coords,DBH), no.X=100, no.Y=100, h=5, m=2, extend=FALSE)$xyz.est
dev.new()
image.plot(surf, xaxs = "r", yaxs = "r", xlab="Easting (m)", ylab="Northing (m)", col=col.br(25))
max.dist=0.25*max(iDist(coords))
bins=50
vario.DBH <- variog(coords=coords, data=DBH, uvec=(seq(0, max.dist, length=bins)))
plot(vario.DBH)
lm.DBH <- lm(DBH~Species, data=WEF.dat)
summary(lm.DBH)
DBH.resid <- resid(lm.DBH)
surf <- mba.surf(cbind(coords,DBH.resid), no.X=100, no.Y=100, h=5, m=2, extend=FALSE)$xyz.est
dev.new()
image.plot(surf, xaxs = "r", yaxs = "r", xlab="Easting (m)", ylab="Northing (m)", col=col.br(25))
vario.DBH.resid <- variog(coords=coords, data=DBH.resid, uvec=(seq(0, max.dist, length=bins)))
plot(vario.DBH.resid)
lmobj2s=lm(y~x+sx+sy,data=data2)
data2$res2=lmobj2s$residuals
myplot(data2,"res2")
vario2s <- variog(coords=data1[,1:2], data=data2$res2, uvec=(seq(0, max.dist, length=bins)))
plot(vario2s,pch=16)
vario2s <- variog(coords=data1[,1:2], data=data2$res2, uvec=(seq(0, max.dist, length=bins)))
plot(vario2s,pch=16)
vario2s <- variog(coords=data1[,1:2], data=data2$res2, uvec=(seq(0, max.dist, length=bins)))
plot(vario2s,pch=16)
dev.new()
lmobj2s=lm(y~x+sx+sy,data=data2)
data2$res2=lmobj2s$residuals
myplot(data2,"res2")
vario2s <- variog(coords=data1[,1:2], data=data2$res2, uvec=(seq(0, max.dist, length=bins)))
plot(vario2s,pch=16)
max.dist <- 0.75*max(iDist(data1[,1:2]))
bins <- 20
lmobj2s=lm(y~x+sx+sy,data=data2)
data2$res2=lmobj2s$residuals
myplot(data2,"res2")
plot(vario2s,pch=16)
max.dist <- 0.75*max(iDist(data1[,1:2]))
bins <- 20
lmobj2s=lm(y~x+sx+sy,data=data2)
data2$res2=lmobj2s$residuals
myplot(data2,"res2")
vario2s <- variog(coords=data1[,1:2], data=data2$res2, uvec=(seq(0, max.dist, length=bins)))
plot(vario2s,pch=16)
lmobj3s=lm(y~x+sx+sy,data=data3)
data3$res2=lmobj3s$residuals
myplot(data3,"res2")
vario3s <- variog(coords=data1[,1:2], data=data3$res2, uvec=(seq(0, max.dist, length=bins)))
plot(vario3s,pch=16)
library(ggplot2)
library(RColorBrewer)
library(akima)
library(fields)
library(ggmap)
library(maps)
library(spBayes)
library(MBA)
library(classInt)
library(plotrix)
data1=read.csv("../data/dataset1.csv")
head(data1)
dev.new()
plot(data1$sx,data1$sy,xlab="",ylab="",main="Data locations")
dev.new()
plot(data1$sx,data1$sy,xlab="",ylab="",main="Data locations")
colors=colorRampPalette(c("midnightblue", "cyan","yellow","red"))(5)
quants=classIntervals(data1$y,n=5,style="quantile")
sc=scale_colour_gradientn(colours = colors,values=rescale(quants$brks,c(0,1)),name="y")
p0 = ggplot(data=data1,aes(x=sx,y=sy))+sc+labs(x = "",y = "")
p1=p0+geom_point(data=data1,aes(x=sx,y=sy,color=y))+guides(fill=guide_colorbar(title="y"))
plot(p1)
intobj1=interp(data1$sx,data1$sy,data1$y,
xo=frange(data1$sx,200),yo=frange(data1$sy,200))
frange=function(x,n) seq(min(x),max(x),length=n)
intobj1=interp(data1$sx,data1$sy,data1$y,
xo=frange(data1$sx,200),yo=frange(data1$sy,200))
head(intobj1)
name(intobj1)
names(intobj1)
intobj1$x
intobj1$y
head(intobj1$z)
interpdata1=cbind(expand.grid(intobj1$x,intobj1$y),as.vector(intobj1$z))
colnames(interpdata1)=c("sx","sy","y")
p1interp=p0+geom_raster(data=interpdata1,aes(x=sx,y=sy,fill=y))+
scale_fill_gradientn(colours=colors,values=rescale(quants$brks,c(0,1)),name="y")
plot(p1interp)
dev.new()
plot(p1)
rm(list=ls())
data(WEF.dat)
head(WEF.dat)
head(WEF.dat)
WEF.dat <- WEF.dat[!apply(WEF.dat[,c("East_m","North_m","DBH_cm","Tree_height_m","ELEV_m")], 1, function(x)any(is.na(x))),]
DBH <- WEF.dat$DBH_cm
coords <- as.matrix(WEF.dat[,c("East_m","North_m")])
plot(coords, pch=1, cex=sqrt(DBH)/10, col="darkgreen", xlab="Easting (m)", ylab="Northing (m)")
dev.new()
plot(coords, pch=1, cex=sqrt(DBH)/10, col="darkgreen", xlab="Easting (m)", ylab="Northing (m)")
leg.vals <- round(quantile(DBH),0)
legend("topleft", pch=1, legend=leg.vals, col="darkgreen", pt.cex=sqrt(leg.vals)/10, bty="n", title="DBH (cm)")
col.br <- colorRampPalette(c("midnightblue", "cyan", "yellow", "red"))
col.pal <- col.br(5)
quant <- classIntervals(DBH, n=5, style="quantile")
plot(quant, pal=col.pal, xlab="DBH", main="Quantile")
quant.col <- findColours(quant, col.pal)
plot(coords, col=quant.col, pch=19, cex=0.5, main="Quantile", xlab="Easting (m)", ylab="Northing (m)")
legend("topleft", fill=attr(quant.col, "palette"),
legend=names(attr(quant.col, "table")), bty="n")
fixed <- classIntervals(DBH, n=4, style="fixed", fixedBreaks=c(0,12.7,30.48,60,max(DBH)+1))
fixed.col <- findColours(fixed, col.pal)
plot(coords, col=fixed.col, pch=19, cex=0.5, main="Forestry tree size classes", xlab="Easting (m)", ylab="Northing (m)")
legend("topleft", fill=attr(fixed.col, "palette"), legend=c("sapling","poletimber","sawtimber","large sawtimber"), bty="n")
x.res <- 100; y.res <- 100
surf <- mba.surf(cbind(coords, DBH), no.X=x.res, no.Y=y.res, h=5, m=2, extend=FALSE)$xyz.est
image.plot(surf, xaxs = "r", yaxs = "r", xlab="Easting (m)", ylab="Northing (m)", col=col.br(25))
rm(list=ls())
library(ggplot2)
library(RColorBrewer)
library(akima)
library(fields)
library(ggmap)
library(maps)
library(spBayes)
library(MBA)
library(classInt)
library(plotrix)
library(geoR)
data1=read.csv("../data/dataset1.csv")
data2=read.csv("../data/dataset2.csv")
data3=read.csv("../data/dataset3.csv")
head(data2)
col.br <- colorRampPalette(c("midnightblue", "cyan", "yellow", "red"))
col.pal <- col.br(5)
myplot=function(tab,colname){
surf <- mba.surf(tab[,c("sx","sy",colname)], no.X=100, no.Y=100, h=5, m=2, extend=FALSE)$xyz.est
dev.new()
image.plot(surf, xaxs = "r", yaxs = "r", xlab="Easting (m)", ylab="Northing (m)", col=col.br(25))
}
dev.new()
myplot(data1,"y")
myplot(data2,"y")
myplot(data3,"y")
myplot(data3,"x")
lmobj1=lm(y~x,data=data1)
lmobj2=lm(y~x,data=data2)
lmobj3=lm(y~x,data=data3)
summary(lmobj1)
summary(lmobj2)
summary(lmobj3)
data1$res=lmobj1$residuals
data2$res=lmobj2$residuals
data3$res=lmobj3$residuals
graphics.off()
dev.new()
myplot(data1,"res")
myplot(data2,"res")
myplot(data3,"res")
vario1raw <- variog(coords=data1[,1:2], data=data1$y, uvec=(seq(0, max.dist, length=bins)))
plot(vario1raw,pch=16)
max.dist <- 0.75*max(iDist(data1[,1:2]))
bins <- 20
vario1raw <- variog(coords=data1[,1:2], data=data1$y, uvec=(seq(0, max.dist, length=bins)))
plot(vario1raw,pch=16)
vario1 <- variog(coords=data1[,1:2], data=data1$res, uvec=(seq(0, max.dist, length=bins)))
plot(vario1,pch=16)
vario2 <- variog(coords=data1[,1:2], data=data2$res, uvec=(seq(0, max.dist, length=bins)))
plot(vario2,pch=16)
vario3 <- variog(coords=data1[,1:2], data=data3$res, uvec=(seq(0, max.dist, length=bins)))
plot(vario3,pch=16)
lmobj2s=lm(y~x+sx+sy,data=data2)
data2$res2=lmobj2s$residuals
myplot(data2,"res2")
vario2s <- variog(coords=data1[,1:2], data=data2$res2, uvec=(seq(0, max.dist, length=bins)))
plot(vario2s,pch=16)
